# ğŸ¯ ìš°ë¦¬ë™ë„¤ CCTV í”„ë¡œì íŠ¸ ë¶„ì„ ë³´ê³ ì„œ

**ë¶„ì„ ì¼ì‹œ**: 2026-01-01  
**í”„ë¡œì íŠ¸ëª…**: RoadEye (ìš°ë¦¬ë™ë„¤ CCTV)  
**ITS API ì¸ì¦í‚¤**: âœ… ì ìš© ì™„ë£Œ

---

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

**ëª©í‘œ**: ì „êµ­ êµí†µ CCTV ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜  
**ê¸°ìˆ  ìŠ¤íƒ**: React + TypeScript (Frontend) / FastAPI (Backend)  
**ì£¼ìš” ê¸°ëŠ¥**: ì§€ë„ ê¸°ë°˜ CCTV ê²€ìƒ‰ ë° ì‹¤ì‹œê°„ ì˜ìƒ ìŠ¤íŠ¸ë¦¬ë°

---

## ğŸ—ï¸ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
ìš°ë¦¬ë™ë„¤CCTV/
â”œâ”€â”€ backend/                    # FastAPI ë°±ì—”ë“œ ì„œë²„
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/               # API ì—”ë“œí¬ì¸íŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ cctv.py        # CCTV ì¡°íšŒ API
â”‚   â”‚   â”‚   â””â”€â”€ streaming.py   # ìŠ¤íŠ¸ë¦¬ë° API
â”‚   â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”‚   â””â”€â”€ config.py      # ì„¤ì • ê´€ë¦¬ (í™˜ê²½ë³€ìˆ˜)
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ its.py         # ITS API í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â”‚   â””â”€â”€ streaming.py   # FFmpeg ìŠ¤íŠ¸ë¦¬ë° ì„œë¹„ìŠ¤
â”‚   â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”‚   â””â”€â”€ cctv.py        # Pydantic ìŠ¤í‚¤ë§ˆ
â”‚   â”‚   â””â”€â”€ main.py            # FastAPI ì•± ì§„ì…ì 
â”‚   â””â”€â”€ requirements.txt       # Python ì˜ì¡´ì„±
â”‚
â”œâ”€â”€ frontend/                   # React í”„ë¡ íŠ¸ì—”ë“œ
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ App.tsx            # ë©”ì¸ ì•± ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â””â”€â”€ VideoPlayer.tsx # ë¹„ë””ì˜¤ í”Œë ˆì´ì–´
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ CCTV_WebApp_Development_Guide.md  # ê°œë°œ ê°€ì´ë“œ
â”œâ”€â”€ ê°œë°œ ì²´í¬ë¦¬ìŠ¤íŠ¸.md                # ê°œë°œ ì²´í¬ë¦¬ìŠ¤íŠ¸
â””â”€â”€ .env                        # í™˜ê²½ ë³€ìˆ˜ (ì¸ì¦í‚¤ í¬í•¨)
```

---

## ğŸ”‘ ì¸ì¦í‚¤ ì ìš© ìƒíƒœ

### âœ… ITS API ì¸ì¦í‚¤
- **ì¸ì¦í‚¤**: `6ec6ee267e83448785c34a81fa31333f`
- **ì ìš© ìœ„ì¹˜**: `.env` íŒŒì¼
- **ì‚¬ìš© ìœ„ì¹˜**: `backend/app/core/config.py` â†’ `settings.ITS_API_KEY`
- **ìƒíƒœ**: âœ… ì ìš© ì™„ë£Œ

### ğŸ“ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
```env
ITS_API_KEY=6ec6ee267e83448785c34a81fa31333f
REDIS_HOST=localhost
REDIS_PORT=6379
```

---

## ğŸ” ì£¼ìš” ê¸°ëŠ¥ ë¶„ì„

### 1. Backend API êµ¬ì¡°

#### CCTV ì¡°íšŒ API (`/api/cctv/nearby`)
- **ì—”ë“œí¬ì¸íŠ¸**: `POST /api/cctv/nearby`
- **ê¸°ëŠ¥**: ì‚¬ìš©ì ìœ„ì¹˜ ê¸°ë°˜ ì£¼ë³€ CCTV ëª©ë¡ ì¡°íšŒ
- **êµ¬í˜„ íŒŒì¼**: `backend/app/api/cctv.py`
- **ì„œë¹„ìŠ¤**: `ITSService.get_nearby_cctvs()`
- **ìš”ì²­ íŒŒë¼ë¯¸í„°**:
  ```json
  {
    "lat": 37.5665,
    "lng": 126.9780,
    "radius": 5000
  }
  ```

#### CCTV ìŠ¤íŠ¸ë¦¼ URL ì¡°íšŒ (`/api/cctv/{cctv_id}/url`)
- **ì—”ë“œí¬ì¸íŠ¸**: `GET /api/cctv/{cctv_id}/url`
- **ê¸°ëŠ¥**: íŠ¹ì • CCTVì˜ RTSP ìŠ¤íŠ¸ë¦¼ URL ë°˜í™˜
- **êµ¬í˜„ íŒŒì¼**: `backend/app/api/cctv.py`

#### ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘ (`/api/stream/start/{cctv_id}`)
- **ì—”ë“œí¬ì¸íŠ¸**: `POST /api/stream/start/{cctv_id}`
- **ê¸°ëŠ¥**: RTSP â†’ HLS ë³€í™˜ ì‹œì‘
- **êµ¬í˜„ íŒŒì¼**: `backend/app/api/streaming.py`
- **ì„œë¹„ìŠ¤**: `StreamingService.start_stream()`
- **ë°˜í™˜ê°’**: HLS í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ URL (`/api/stream/{cctv_id}/playlist.m3u8`)

#### ìŠ¤íŠ¸ë¦¬ë° ì¤‘ë‹¨ (`/api/stream/stop/{cctv_id}`)
- **ì—”ë“œí¬ì¸íŠ¸**: `POST /api/stream/stop/{cctv_id}`
- **ê¸°ëŠ¥**: ìŠ¤íŠ¸ë¦¬ë° ì¤‘ë‹¨ ë° ë¦¬ì†ŒìŠ¤ ì •ë¦¬

### 2. ITS API ì—°ë™

#### ITS ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ (`ITSService`)
- **íŒŒì¼**: `backend/app/services/its.py`
- **Base URL**: `https://openapi.its.go.kr:9443`
- **ì£¼ìš” ë©”ì„œë“œ**:
  1. `get_nearby_cctvs()`: ì¢Œí‘œ ë²”ìœ„ ë‚´ CCTV ëª©ë¡ ì¡°íšŒ
  2. `get_cctv_url()`: íŠ¹ì • CCTVì˜ RTSP URL ì¡°íšŒ

#### API í˜¸ì¶œ íë¦„
```
ì‚¬ìš©ì ìš”ì²­ â†’ FastAPI ì—”ë“œí¬ì¸íŠ¸ â†’ ITSService â†’ ITS API (XML) â†’ JSON ë³€í™˜ â†’ ì‘ë‹µ
```

#### ë°ì´í„° íŒŒì‹±
- **ì‘ë‹µ í˜•ì‹**: XML â†’ `xmltodict`ë¡œ JSON ë³€í™˜
- **CCTV ì •ë³´ êµ¬ì¡°**:
  ```python
  CCTVInfo(
      cctv_id: str,
      cctv_name: str,
      lat: float,
      lng: float,
      stream_url: str,
      owner: str = "ITS"
  )
  ```

### 3. ìŠ¤íŠ¸ë¦¬ë° ì„œë¹„ìŠ¤

#### FFmpeg ê¸°ë°˜ RTSP â†’ HLS ë³€í™˜
- **ì„œë¹„ìŠ¤ í´ë˜ìŠ¤**: `StreamingService`
- **íŒŒì¼**: `backend/app/services/streaming.py`
- **ê¸°ëŠ¥**:
  - RTSP ìŠ¤íŠ¸ë¦¼ì„ HLS í˜•ì‹ìœ¼ë¡œ ë³€í™˜
  - ë™ì‹œ ìŠ¤íŠ¸ë¦¼ ì œí•œ (ìµœëŒ€ 10ê°œ)
  - ìë™ ë¦¬ì†ŒìŠ¤ ì •ë¦¬

#### FFmpeg ëª…ë ¹ì–´
```bash
ffmpeg \
  -rtsp_transport tcp \
  -i {rtsp_url} \
  -c:v libx264 \
  -preset ultrafast \
  -tune zerolatency \
  -c:a aac \
  -b:a 128k \
  -f hls \
  -hls_time 2 \
  -hls_list_size 5 \
  -hls_flags delete_segments+omit_endlist \
  {output_path}/playlist.m3u8
```

### 4. Frontend êµ¬ì¡°

#### ë©”ì¸ ì•± (`App.tsx`)
- **ì§€ë„**: ë„¤ì´ë²„ ì§€ë„ API ì‚¬ìš©
- **ì£¼ìš” ê¸°ëŠ¥**:
  - ì§€ë„ ê¸°ë°˜ CCTV ë§ˆì»¤ í‘œì‹œ
  - CCTV ëª©ë¡ ì‚¬ì´ë“œë°”
  - ê²€ìƒ‰ ê¸°ëŠ¥
  - ë¹„ë””ì˜¤ í”Œë ˆì´ì–´ ëª¨ë‹¬

#### ë¹„ë””ì˜¤ í”Œë ˆì´ì–´ (`VideoPlayer.tsx`)
- **ê¸°ëŠ¥**: HLS ìŠ¤íŠ¸ë¦¼ ì¬ìƒ
- **í†µí•©**: Video.js ë˜ëŠ” ë„¤ì´í‹°ë¸Œ HTML5 ë¹„ë””ì˜¤

---

## ğŸ“¦ ì˜ì¡´ì„± ë¶„ì„

### Backend ì˜ì¡´ì„± (`requirements.txt`)
```
fastapi==0.104.1          # ì›¹ í”„ë ˆì„ì›Œí¬
uvicorn==0.24.0           # ASGI ì„œë²„
httpx==0.25.1             # ë¹„ë™ê¸° HTTP í´ë¼ì´ì–¸íŠ¸
redis==5.0.1              # Redis í´ë¼ì´ì–¸íŠ¸
python-dotenv==1.0.0      # í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬
pydantic==2.5.2            # ë°ì´í„° ê²€ì¦
pydantic-settings==2.1.0  # ì„¤ì • ê´€ë¦¬
xmltodict==0.13.0         # XML â†’ JSON ë³€í™˜
```

### Frontend ì˜ì¡´ì„± (ì¶”ì •)
- React 18 + TypeScript
- Vite (ë¹Œë“œ ë„êµ¬)
- Tailwind CSS (ìŠ¤íƒ€ì¼ë§)
- ë„¤ì´ë²„ ì§€ë„ API
- Video.js ë˜ëŠ” HLS.js

---

## ğŸ”„ API í˜¸ì¶œ íë¦„

### CCTV ëª©ë¡ ì¡°íšŒ íë¦„
```
1. ì‚¬ìš©ìê°€ ì§€ë„ ì´ë™/í™•ëŒ€
   â†“
2. Frontend: POST /api/cctv/nearby
   { lat, lng, radius }
   â†“
3. Backend: ITSService.get_nearby_cctvs()
   â†“
4. ITS API í˜¸ì¶œ (XML ì‘ë‹µ)
   â†“
5. XML â†’ JSON ë³€í™˜
   â†“
6. CCTVInfo ê°ì²´ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
   â†“
7. Frontend: ì§€ë„ì— ë§ˆì»¤ í‘œì‹œ
```

### CCTV ì˜ìƒ ì¬ìƒ íë¦„
```
1. ì‚¬ìš©ìê°€ CCTV ë§ˆì»¤ í´ë¦­
   â†“
2. Frontend: POST /api/stream/start/{cctv_id}
   â†“
3. Backend: ITSService.get_cctv_url() â†’ RTSP URL ì¡°íšŒ
   â†“
4. Backend: StreamingService.start_stream()
   â†’ FFmpeg í”„ë¡œì„¸ìŠ¤ ì‹œì‘
   â†’ HLS ì„¸ê·¸ë¨¼íŠ¸ ìƒì„±
   â†“
5. Backend: HLS URL ë°˜í™˜
   /api/stream/{cctv_id}/playlist.m3u8
   â†“
6. Frontend: VideoPlayerì— HLS URL ì„¤ì •
   â†“
7. ë¸Œë¼ìš°ì €: HLS.jsë¡œ ìŠ¤íŠ¸ë¦¼ ì¬ìƒ
```

---

## âš™ï¸ ì„¤ì • ê´€ë¦¬

### í™˜ê²½ ë³€ìˆ˜ êµ¬ì¡°
```python
# backend/app/core/config.py
class Settings(BaseSettings):
    ITS_API_KEY: str = ""        # ITS API ì¸ì¦í‚¤
    REDIS_HOST: str = "localhost"
    REDIS_PORT: int = 6379
    
    model_config = SettingsConfigDict(env_file=".env")
```

### ì„¤ì • ë¡œë“œ ìˆœì„œ
1. `.env` íŒŒì¼ì—ì„œ ë¡œë“œ
2. í™˜ê²½ ë³€ìˆ˜ì—ì„œ ë¡œë“œ (ìš°ì„ ìˆœìœ„ ë†’ìŒ)
3. ê¸°ë³¸ê°’ ì‚¬ìš©

---

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### Backend ì‹¤í–‰
```bash
cd backend
pip install -r requirements.txt
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### Frontend ì‹¤í–‰
```bash
cd frontend
npm install
npm run dev
```

### í™˜ê²½ ë³€ìˆ˜ í™•ì¸
```bash
# .env íŒŒì¼ì´ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ìˆëŠ”ì§€ í™•ì¸
cat .env
```

---

## ğŸ” ì£¼ìš” ì´ìŠˆ ë° ê°œì„  ì‚¬í•­

### âœ… ì™„ë£Œëœ ì‚¬í•­
- [x] ITS API ì¸ì¦í‚¤ ì ìš©
- [x] ê¸°ë³¸ API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
- [x] ìŠ¤íŠ¸ë¦¬ë° ì„œë¹„ìŠ¤ êµ¬í˜„
- [x] Frontend ê¸°ë³¸ UI êµ¬í˜„

### âš ï¸ í™•ì¸ í•„ìš” ì‚¬í•­
1. **Redis ì—°ê²°**: í˜„ì¬ ì½”ë“œì—ì„œ Redis ì‚¬ìš© ì—¬ë¶€ í™•ì¸ í•„ìš”
2. **ì—ëŸ¬ í•¸ë“¤ë§**: ITS API ì‹¤íŒ¨ ì‹œ ì²˜ë¦¬ ë¡œì§ í™•ì¸
3. **CORS ì„¤ì •**: Frontendì™€ Backend ë„ë©”ì¸ í™•ì¸
4. **FFmpeg ì„¤ì¹˜**: ì„œë²„ì— FFmpeg ì„¤ì¹˜ í•„ìš”

### ğŸ’¡ ê°œì„  ì œì•ˆ
1. **ìºì‹±**: Redisë¥¼ í™œìš©í•œ CCTV ëª©ë¡ ìºì‹±
2. **ì—ëŸ¬ ì²˜ë¦¬**: ë” ìƒì„¸í•œ ì—ëŸ¬ ë©”ì‹œì§€ ë° ë¡œê¹…
3. **ì„±ëŠ¥ ìµœì í™”**: ë™ì‹œ ìŠ¤íŠ¸ë¦¼ ì œí•œ ë° ë¦¬ì†ŒìŠ¤ ê´€ë¦¬
4. **ë³´ì•ˆ**: API í‚¤ í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬ ê°•í™”

---

## ğŸ“Š API ì—”ë“œí¬ì¸íŠ¸ ìš”ì•½

| ë©”ì„œë“œ | ì—”ë“œí¬ì¸íŠ¸ | ê¸°ëŠ¥ | ìƒíƒœ |
|--------|-----------|------|------|
| POST | `/api/cctv/nearby` | ì£¼ë³€ CCTV ëª©ë¡ ì¡°íšŒ | âœ… |
| GET | `/api/cctv/{cctv_id}/url` | CCTV ìŠ¤íŠ¸ë¦¼ URL ì¡°íšŒ | âœ… |
| POST | `/api/stream/start/{cctv_id}` | ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘ | âœ… |
| POST | `/api/stream/stop/{cctv_id}` | ìŠ¤íŠ¸ë¦¬ë° ì¤‘ë‹¨ | âœ… |
| GET | `/api/stream/active` | í™œì„± ìŠ¤íŠ¸ë¦¼ ëª©ë¡ | âœ… |
| GET | `/api/stream/{cctv_id}/{file_name}` | HLS íŒŒì¼ ì œê³µ | âœ… |
| GET | `/health` | í—¬ìŠ¤ì²´í¬ | âœ… |

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

1. **í…ŒìŠ¤íŠ¸ ì‹¤í–‰**
   - Backend ì„œë²„ ì‹¤í–‰ í™•ì¸
   - ITS API í˜¸ì¶œ í…ŒìŠ¤íŠ¸
   - ìŠ¤íŠ¸ë¦¬ë° ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

2. **í™˜ê²½ ì„¤ì • í™•ì¸**
   - FFmpeg ì„¤ì¹˜ í™•ì¸
   - Redis ì„œë²„ ì‹¤í–‰ í™•ì¸
   - ë„¤íŠ¸ì›Œí¬ ì„¤ì • í™•ì¸

3. **ê°œë°œ ì§„í–‰**
   - ê°œë°œ ê°€ì´ë“œ ë¬¸ì„œ ì°¸ì¡°
   - ì²´í¬ë¦¬ìŠ¤íŠ¸ ë”°ë¼ ì§„í–‰

---

## ğŸ“ ì°¸ê³  ìë£Œ

- **ITS êµ­ê°€êµí†µì •ë³´ì„¼í„°**: https://www.its.go.kr/
- **ê°œë°œ ê°€ì´ë“œ**: `CCTV_WebApp_Development_Guide.md`
- **ì²´í¬ë¦¬ìŠ¤íŠ¸**: `ê°œë°œ ì²´í¬ë¦¬ìŠ¤íŠ¸.md`

---

**ë¶„ì„ ì™„ë£Œì¼**: 2026-01-01  
**ì¸ì¦í‚¤ ì ìš©**: âœ… ì™„ë£Œ  
**í”„ë¡œì íŠ¸ ìƒíƒœ**: ê°œë°œ ì§„í–‰ ì¤‘


